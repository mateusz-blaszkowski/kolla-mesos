name: openstack/ironic/ironic-pxe
enabled: {{ enable_ironic | bool }}
container:
  image: "{{ ironic_pxe_image }}:{{ ironic_pxe_tag }}"
  privileged: true
  parameters:
    - key: volume
      value: "kolla_logs_{{ deployment_id }}_{{ timestamp }}:/var/log/kolla"
  volumes:
    - containerPath: "/tftpboot"
      hostPath: "/tftpboot"
      mode: RW
service:
  daemon:
    dependencies:
     - path: ironic_ansible_tasks/create_user
     - path: ironic-pxe/tftpboot_create
    command: /usr/sbin/in.tftpd --verbose --foreground --user root --address 0.0.0.0:69 --map-file /map-file /tftpboot
  mem: {{ ironic_pxe_mem }}
  cpus: {{ ironic_pxe_cpus }}
  instances: {{ controller_nodes }}
  constraints: {{ controller_constraints }}
commands:
  extend_start:
    command: kolla_extend_start
  tftpboot_create:
    run_once: True
    command: kolla_extend_start
    env:
      KOLLA_BOOTSTRAP:

